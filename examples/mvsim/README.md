# MVSim Example

This example demonstrates how to use MVSim (Multi-Vehicle Simulator) with world files generated by ROS GridMap Generator using ROS2 Humble.

## Quick Start

1. Make sure you have exported map files from the main application to `../shared/maps/`
2. Build and run the container:

```bash
# Build the image
docker-compose build mvsim

# Run the container
docker-compose run --rm mvsim
```

## Available Commands

Once inside the container, you can run:

### Launch with Auto-Detection (Recommended)
```bash
ros2 launch ./launch/test_world.launch.py
```
This automatically detects the generated world file or falls back to demo world if no maps are found. Uses the official MVSim launch system with proper ROS2 integration.

### Launch with Specific World File
```bash
ros2 launch ./launch/test_world.launch.py world_file:=/workspace/maps/world_mvsim.xml
```
This loads a specific MVSim world file using the official launch system.

### Launch Options
```bash
ros2 launch ./launch/test_world.launch.py use_rviz:=false    # Without RViz
ros2 launch ./launch/test_world.launch.py headless:=true     # Headless mode
```

### Official MVSim Demo
```bash
ros2 launch mvsim mvsim_tutorial/demo_warehouse.launch.py
```
This runs the official MVSim warehouse demo with default settings.

### Manual Map Server (for reference only)
```bash
ros2 run nav2_map_server map_server --ros-args -p yaml_filename:=/workspace/maps/map_ros2.yaml
```
Note: MVSim uses its own world format, not PGM/YAML maps.

## Required Files

Make sure this file exists in `../shared/maps/`:
- `world_mvsim.xml` - Generated MVSim world file

The PGM/YAML files are generated for reference but MVSim uses its own XML world format.

## Troubleshooting

### GUI Not Showing
Make sure X11 forwarding is enabled:
```bash
xhost +local:docker
```

### No World File
If `world_mvsim.xml` doesn't exist, the launch file will automatically fall back to MVSim's built-in demo world.

## MVSim Features

- **2D Physics Simulation**: Realistic dynamics using Box2D
- **Multi-Vehicle Support**: Simulate multiple robots
- **Various Vehicle Types**: Differential drive, Ackermann steering
- **Sensors**: Laser scanners, cameras, odometry
- **ROS Integration**: Publishes sensor data and accepts velocity commands
- **Headless Mode**: Can run without GUI for CI/CD

## Topics and Services

When running with ROS2, MVSim publishes:
- `/r1/laser1/scan` - Laser scan data
- `/r1/odom` - Odometry
- `/r1/base_pose_ground_truth` - Ground truth pose

And subscribes to:
- `/r1/cmd_vel` - Velocity commands

## Configuration

The generated world file contains:
- Ground plane matching your map dimensions
- Vertical planes for walls at the positions you defined
- Default vehicle configuration for testing